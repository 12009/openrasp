# Tomcat based 
FROM tomcat:8.0
MAINTAINER Som

ENV CATALINA_HOME /usr/local/tomcat
ENV PATH $CATALINA_HOME/bin:$PATH
RUN mkdir -p "$CATALINA_HOME"
WORKDIR $CATALINA_HOME

RUN wget --no-check-certificate https://github.com/baidu/openrasp/releases/download/v0.20/rasp-any.tar.gz -P $CATALINA_HOME
RUN cd $CATALINA_HOME
RUN tar zxvf rasp-linux-64bit.tar.gz
RUN mv rasp-*/rasp  $CATALINA_HOME
RUN rm -rf rasp-linux*
RUN wget --no-check-certificate https://github.com/baidu-security/openrasp-testcases/releases/download/v1.0.1/vulns.war -P $CATALINA_HOME/webapps

RUN sed -i '349c JAVA_OPTS="-javaagent:${CATALINA_HOME}/rasp/rasp.jar ${JAVA_OPTS}"   JAVA_OPTS="-Dlog4j.rasp.configuration=file://${CATALINA_HOME}/rasp/conf/rasp-log4j.xml ${JAVA_OPTS}"' $CATALINA_HOME/bin/catalina.sh

EXPOSE 8080
CMD ["catalina.sh", "run"]
